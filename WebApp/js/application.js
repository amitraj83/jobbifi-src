$(function(){"use strict";function t(t,e,n,s){o.append('<p><span style="color:'+n+'">'+t+"</span> @ "+ +(s.getHours()<10?"0"+s.getHours():s.getHours())+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes())+": "+e+"</p>")}var e,o=($("#header"),$("#content")),n=$("#input"),s=$("#status"),r=!1,a=null,i=!1,l=atmosphere,c="websocket",u="http://localhost:8080/interviewbackend/chat?from=amitraj&to=atul",p={url:u,contentType:"application/json",logLevel:"debug",transport:c,trackMessageLength:!0,reconnectInterval:5e3,fallbackTransport:"long-polling"};p.onOpen=function(t){o.html($("<p>",{text:"Atmosphere connected using "+t.transport})),n.removeAttr("disabled").focus(),s.text("Choose name:"),c=t.transport},p.onReopen=function(t){n.removeAttr("disabled").focus(),o.html($("<p>",{text:"Atmosphere re-connected using "+t.transport}))},p.onTransportFailure=function(t,e){atmosphere.util.info(t),window.EventSource&&(e.fallbackTransport="sse")},p.onMessage=function(e){var o=e.responseBody;try{var l=atmosphere.util.parseJSON(o)}catch(c){return void console.log("This doesn't look like a valid JSON: ",o)}if(n.removeAttr("disabled").focus(),!i&&r)i=!0,s.text(r+": ").css("color","blue");else{var u=l.author==a,p="string"==typeof l.time?parseInt(l.time):l.time;t(l.author,l.message,u?"blue":"black",new Date(p))}},p.onClose=function(t){o.html($("<p>",{text:"Client closed the connection after a timeout"})),e.push(atmosphere.util.stringifyJSON({author:a,message:"disconnecting"})),n.attr("disabled","disabled")},p.onError=function(t){o.html($("<p>",{text:"Sorry, but there's some problem with your socket or the server is down"})),i=!1},p.onReconnect=function(t,e){o.html($("<p>",{text:"Connection lost, trying to reconnect. Trying to reconnect "+t.reconnectInterval})),n.attr("disabled","disabled")},e=l.subscribe(p),n.keydown(function(t){if(13===t.keyCode){var o=$(this).val();null==a&&(a=o),e.push(atmosphere.util.stringifyJSON({author:a,message:o})),$(this).val(""),n.attr("disabled","disabled"),r===!1&&(r=o)}})});