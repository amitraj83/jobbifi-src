!function(){"use strict";var e,t="2.0.0-javascript",n={},o=[],r=[];n={onError:function(e){},onClose:function(e){},onOpen:function(e){},onReopen:function(e){},onMessage:function(e){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){},onLocalMessage:function(e){},onFailureToReconnect:function(e,t){},AtmosphereRequest:function(e){function o(){fe=!0,ge=!1,pe=0,ie=null,ce=null,le=null,ue=null}function s(){l(),o()}function a(e,t){""==ae.partialMessage&&"streaming"==t.transport&&e.responseText.length>t.maxStreamingLength&&(ae.messages=[],te(!0),i(),l(),E(e,t,0))}function i(){if(se.enableProtocol&&!se.firstMessage){var e="X-Atmosphere-Transport=close&X-Atmosphere-tracking-id="+se.uuid,t=se.url.replace(/([?&])_=[^&]*/,e);t+=t===se.url?(/\?/.test(se.url)?"&":"?")+e:"",se.attachHeadersAsQueryString=!1,se.dropAtmosphereHeaders=!0,se.url=t,se.transport="polling",j("",se)}}function c(){se.reconnect=!1,ge=!0,ae.request=se,ae.state="unsubscribe",ae.responseBody="",ae.status=408,ne(),i(),l()}function l(){null!=ue&&(ue.close(),ue=null),null!=de&&(de.abort(),de=null),null!=le&&(le.abort(),le=null),null!=ie&&(ie.webSocketOpened&&ie.close(),ie=null),null!=ce&&(ce.close(),ce=null),u()}function u(){null!=oe&&(clearInterval(re),document.cookie=encodeURIComponent("atmosphere-"+se.url)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT",oe.signal("close",{reason:"",heir:ge?(oe.get("children")||[])[0]:be}),oe.close()),null!=he&&he.close()}function d(e){s(),se=n.util.extend(se,e),se.mrequest=se.reconnect,se.reconnect||(se.reconnect=!0)}function f(){return null!=se.webSocketImpl||window.WebSocket||window.MozWebSocket}function p(){return window.EventSource}function g(){if(se.shared){if(he=m(se),null!=he&&("debug"==se.logLevel&&n.util.debug("Storage service available. All communication will be local"),he.open(se)))return;"debug"==se.logLevel&&n.util.debug("No Storage service available."),he=null}se.firstMessage=!0,se.isOpen=!1,se.ctime=n.util.now(),"websocket"!=se.transport&&"sse"!=se.transport?q(se):"websocket"==se.transport?f()?k(!1):L("Websocket is not supported, using request.fallbackTransport ("+se.fallbackTransport+")"):"sse"==se.transport&&(p()?T(!1):L("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+se.fallbackTransport+")"))}function m(e){function t(e,t){var n,o=e.length;for(n=0;o>n;n++)e[n]===t&&e.splice(n,1);return o!==e.length}function o(t){var o=n.util.parseJSON(t),r=o.data;if("c"===o.target)switch(o.type){case"open":b("opening","local",se);break;case"close":i||(i=!0,"aborted"===r.reason?c():r.heir===be?g():setTimeout(function(){g()},100));break;case"message":K(r,"messageReceived",200,e.transport);break;case"localMessage":_(r)}}function r(){var e=new RegExp("(?:^|; )("+encodeURIComponent(l)+")=([^;]*)").exec(document.cookie);return e?n.util.parseJSON(decodeURIComponent(e[2])):void 0}var s,a,i,l="atmosphere-"+e.url,u={storage:function(){if(n.util.supportStorage()){var r=window.localStorage,s=function(e){return n.util.parseJSON(r.getItem(l+"-"+e))},a=function(e,t){r.setItem(l+"-"+e,n.util.stringifyJSON(t))};return{init:function(){return a("children",s("children").concat([be])),n.util.on("storage.socket",function(e){e=e.originalEvent,e.key===l&&e.newValue&&o(e.newValue)}),s("opened")},signal:function(e,t){r.setItem(l,n.util.stringifyJSON({target:"p",type:e,data:t}))},close:function(){var o=s("children");n.util.off("storage.socket"),o&&t(o,e.id)&&a("children",o)}}}},windowref:function(){var e=window.open("",l.replace(/\W/g,""));if(e&&!e.closed&&e.callbacks)return{init:function(){return e.callbacks.push(o),e.children.push(be),e.opened},signal:function(t,o){!e.closed&&e.fire&&e.fire(n.util.stringifyJSON({target:"p",type:t,data:o}))},close:function(){i||(t(e.callbacks,o),t(e.children,be))}}}};return s=r(),!s||n.util.now()-s.ts>1e3||!(a=u.storage()||u.windowref())?void 0:{open:function(){var t;return re=setInterval(function(){var e=s;s=r(),s&&e.ts!==s.ts||o(n.util.stringifyJSON({target:"c",type:"close",data:{reason:"error",heir:e.heir}}))},1e3),t=a.init(),t&&setTimeout(function(){b("opening","local",e)},50),t},send:function(e){a.signal("send",e)},localSend:function(e){a.signal("localSend",n.util.stringifyJSON({id:be,event:e}))},close:function(){ge||(clearInterval(re),a.signal("close"),a.close())}}}function h(){function e(e){var t=n.util.parseJSON(e),o=t.data;if("p"===t.target)switch(t.type){case"send":P(o);break;case"localSend":_(o);break;case"close":c()}}function t(){document.cookie=encodeURIComponent(r)+"="+encodeURIComponent(n.util.stringifyJSON({ts:n.util.now()+1,heir:(o.get("children")||[])[0]}))}var o,r="atmosphere-"+se.url,s={storage:function(){if(n.util.supportStorage()){var t=window.localStorage;return{init:function(){n.util.on("storage.socket",function(t){t=t.originalEvent,t.key===r&&t.newValue&&e(t.newValue)})},signal:function(e,o){t.setItem(r,n.util.stringifyJSON({target:"c",type:e,data:o}))},get:function(e){return n.util.parseJSON(t.getItem(r+"-"+e))},set:function(e,o){t.setItem(r+"-"+e,n.util.stringifyJSON(o))},close:function(){n.util.off("storage.socket"),t.removeItem(r),t.removeItem(r+"-opened"),t.removeItem(r+"-children")}}}},windowref:function(){var t,o=r.replace(/\W/g,""),s=document.getElementById(o);return s||(s=document.createElement("div"),s.id=o,s.style.display="none",s.innerHTML='<iframe name="'+o+'" />',document.body.appendChild(s)),t=s.firstChild.contentWindow,{init:function(){t.callbacks=[e],t.fire=function(e){var n;for(n=0;n<t.callbacks.length;n++)t.callbacks[n](e)}},signal:function(e,o){!t.closed&&t.fire&&t.fire(n.util.stringifyJSON({target:"c",type:e,data:o}))},get:function(e){return t.closed?null:t[e]},set:function(e,n){t.closed||(t[e]=n)},close:function(){}}}};me=function(e){o.signal("message",e)},o=s.storage()||s.windowref(),o.init(),"debug"==se.logLevel&&n.util.debug("Installed StorageService "+o),o.set("children",[]),null==o.get("opened")||o.get("opened")||o.set("opened",!1),t(),re=setInterval(t,1e3),oe=o}function b(e,t,n){if(se.shared&&"local"!=t&&h(),null!=oe&&oe.set("opened",!0),n.close=function(){c()},pe>0&&"re-connecting"==e)n.isReopen=!0,B(ae);else if(null==ae.error){ae.request=n;var o=ae.state;ae.state=e;var r=ae.transport;ae.transport=t;var s=ae.responseBody;ne(),ae.responseBody=s,ae.state=o,ae.transport=r}}function v(e){e.transport="jsonp";var t=se;null!=e&&"undefined"!=typeof e&&(t=e),de={open:function(){function e(){var e=t.url;null!=t.dispatchUrl&&(e+=t.dispatchUrl);var n=t.data;t.attachHeadersAsQueryString&&(e=I(t),""!=n&&(e+="&X-Atmosphere-Post-Body="+encodeURIComponent(n)),n="");var r=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");s.src=e+"&jsonpTransport="+o,s.clean=function(){s.clean=s.onerror=s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s)},s.onload=s.onreadystatechange=function(){(!s.readyState||/loaded|complete/.test(s.readyState))&&s.clean()},s.onerror=function(){s.clean(),x(0,"maxReconnectOnClose reached")},r.insertBefore(s,r.firstChild)}var o="atmosphere"+ ++be;window[o]=function(e){if(t.reconnect)if(-1==t.maxRequest||t.requestCount++<t.maxRequest){if(t.executeCallbackBeforeReconnect||E(de,t,0),null!=e&&"string"!=typeof e)try{e=e.message}catch(o){}var r=O(e,t,ae);r||K(ae.responseBody,"messageReceived",200,t.transport),t.executeCallbackBeforeReconnect&&E(de,t,0)}else n.util.log(se.logLevel,["JSONP reconnect maximum try reached "+se.requestCount]),x(0,"maxRequest reached")},setTimeout(function(){e()},50)},abort:function(){script.clean&&script.clean()}},de.open()}function w(e){return null!=se.webSocketImpl?se.webSocketImpl:window.WebSocket?new WebSocket(e):new MozWebSocket(e)}function y(){return n.util.getAbsoluteURL(I(se)).replace(/^http/,"ws")}function S(){var e=I(se);return e}function T(e){ae.transport="sse";var t=S(se.url);if("debug"==se.logLevel&&(n.util.debug("Invoking executeSSE"),n.util.debug("Using URL: "+t)),se.enableProtocol&&e){var o=n.util.now()-se.ctime;se.lastTimestamp=Number(se.stime)+Number(o)}if(e&&!se.reconnect)return void(null!=ce&&l());try{ce=new EventSource(t,{withCredentials:se.withCredentials})}catch(r){return x(0,r),void L("SSE failed. Downgrading to fallback transport and resending")}se.connectTimeout>0&&(se.id=setTimeout(function(){e||l()},se.connectTimeout)),ce.onopen=function(t){C(se),"debug"==se.logLevel&&n.util.debug("SSE successfully opened"),se.enableProtocol||(e?b("re-opening","sse",se):b("opening","sse",se)),e=!0,"POST"==se.method&&(ae.state="messageReceived",ce.send(se.data))},ce.onmessage=function(e){if(C(se),e.origin&&e.origin!=window.location.protocol+"//"+window.location.host)return void n.util.log(se.logLevel,["Origin was not "+window.location.protocol+"//"+window.location.host]);ae.state="messageReceived",ae.status=200,e=e.data;var t=O(e,se,ae);ce.URL&&(ce.interval=100,ce.URL=S(se.url)),t||(ne(),ae.responseBody="",ae.messages=[])},ce.onerror=function(t){clearTimeout(se.id),te(e),l(),ge?n.util.log(se.logLevel,["SSE closed normally"]):e?se.reconnect&&"sse"==ae.transport&&(pe++<se.maxReconnectOnClose?(b("re-connecting",se.transport,se),se.id=setTimeout(function(){T(!0)},se.reconnectInterval),ae.responseBody="",ae.messages=[]):(n.util.log(se.logLevel,["SSE reconnect maximum try reached "+pe]),x(0,"maxReconnectOnClose reached"))):L("SSE failed. Downgrading to fallback transport and resending")}}function k(e){if(ae.transport="websocket",se.enableProtocol&&e){var t=n.util.now()-se.ctime;se.lastTimestamp=Number(se.stime)+Number(t)}var o=y(se.url);return"debug"==se.logLevel&&(n.util.debug("Invoking executeWebSocket"),n.util.debug("Using URL: "+o)),e&&!se.reconnect?void(null!=ie&&l()):(ie=w(o),null!=se.webSocketBinaryType&&(ie.binaryType=se.webSocketBinaryType),se.connectTimeout>0&&(se.id=setTimeout(function(){if(e);else{var t={code:1002,reason:"",wasClean:!1};ie.onclose(t);try{l()}catch(n){}}},se.connectTimeout)),ie.onopen=function(t){C(se),"debug"==se.logLevel&&n.util.debug("Websocket successfully opened"),se.enableProtocol||(e?b("re-opening","websocket",se):b("opening","websocket",se)),e=!0,ie.webSocketOpened=e,"POST"==se.method&&(ae.state="messageReceived",ie.send(se.data))},ie.onmessage=function(e){C(se),ae.state="messageReceived",ae.status=200;var e=e.data,t="string"==typeof e;if(t){var n=O(e,se,ae);n||(ne(),ae.responseBody="",ae.messages=[])}else{if(!R(se,e))return;ae.responseBody=e,ne(),ae.responseBody=null}},ie.onerror=function(e){clearTimeout(se.id)},ie.onclose=function(t){if(clearTimeout(se.id),"closed"!=ae.state){var o=t.reason;if(""===o)switch(t.code){case 1e3:o="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:o="The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.";break;case 1002:o="The endpoint is terminating the connection due to a protocol error.";break;case 1003:o="The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:o="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:o="Unknown: no status code was provided even though one was expected.";break;case 1006:o="Connection was closed abnormally (that is, with no close frame being sent)."}n.util.warn("Websocket closed, reason: "+o),n.util.warn("Websocket closed, wasClean: "+t.wasClean),te(e),ae.state="closed",ge?n.util.log(se.logLevel,["Websocket closed normally"]):e?se.reconnect&&"websocket"==ae.transport&&(l(),pe++<se.maxReconnectOnClose?(b("re-connecting",se.transport,se),se.id=setTimeout(function(){ae.responseBody="",ae.messages=[],k(!0)},se.reconnectInterval)):(n.util.log(se.logLevel,["Websocket reconnect maximum try reached "+se.requestCount]),n.util.warn("Websocket error, reason: "+t.reason),x(0,"maxReconnectOnClose reached"))):L("Websocket failed. Downgrading to Comet and resending")}},void(void 0===ie.url&&ie.onclose({reason:"Android 4.1 does not support websockets.",wasClean:!1})))}function R(e,t){var o=!0;if(0!=n.util.trim(t)&&e.enableProtocol&&e.firstMessage){e.firstMessage=!1;var r=t.split(e.messageDelimiter),s=2==r.length?0:1;e.uuid=n.util.trim(r[s]),e.stime=n.util.trim(r[s+1]),o=!1,"long-polling"!=e.transport&&U(e)}else U(e);return o}function C(e){clearTimeout(e.id),"polling"!=e.transport&&(e.id=setTimeout(function(){te(!0),l(),i()},e.timeout))}function x(e,t){l(),clearTimeout(se.id),ae.state="error",ae.reasonPhrase=t,ae.responseBody="",ae.status=e,ae.messages=[],ne()}function O(e,t,o){if(!R(se,e))return!0;if(0==e.length)return!0;if(t.trackMessageLength){e=o.partialMessage+e;for(var r=[],s=e.indexOf(t.messageDelimiter);-1!=s;){var a=n.util.trim(e.substring(0,s)),i=parseInt(a);if(isNaN(i))throw'message length "'+a+'" is not a number';s+=t.messageDelimiter.length,s+i>e.length?s=-1:(r.push(e.substring(s,s+i)),e=e.substring(s+i,e.length),s=e.indexOf(t.messageDelimiter))}return o.partialMessage=e,0!=r.length?(o.responseBody=r.join(t.messageDelimiter),o.messages=r,!1):(o.responseBody="",o.messages=[],!0)}return o.responseBody=e,!1}function L(e){n.util.log(se.logLevel,[e]),"undefined"!=typeof se.onTransportFailure?se.onTransportFailure(e,se):"undefined"!=typeof n.util.onTransportFailure&&n.util.onTransportFailure(e,se),se.transport=se.fallbackTransport;var t=-1==se.connectTimeout?0:se.connectTimeout;se.reconnect&&"none"!=se.transport||null==se.transport?(se.method=se.fallbackMethod,ae.transport=se.fallbackTransport,se.fallbackTransport="none",se.id=setTimeout(function(){g()},t)):x(500,"Unable to reconnect with fallback transport")}function I(e,o){var r=se;return null!=e&&"undefined"!=typeof e&&(r=e),null==o&&(o=r.url),r.attachHeadersAsQueryString?-1!=o.indexOf("X-Atmosphere-Framework")?o:(o+=-1!=o.indexOf("?")?"&":"?",o+="X-Atmosphere-tracking-id="+r.uuid,o+="&X-Atmosphere-Framework="+t,o+="&X-Atmosphere-Transport="+r.transport,r.trackMessageLength&&(o+="&X-Atmosphere-TrackMessageSize=true"),o+=void 0!=r.lastTimestamp?"&X-Cache-Date="+r.lastTimestamp:"&X-Cache-Date=0",""!=r.contentType&&(o+="&Content-Type="+r.contentType),r.enableProtocol&&(o+="&X-atmo-protocol=true"),n.util.each(r.headers,function(t,s){var a=n.util.isFunction(s)?s.call(this,r,e,ae):s;null!=a&&(o+="&"+encodeURIComponent(t)+"="+encodeURIComponent(a))}),o):o}function M(){return n.util.browser.msie&&"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")}),new XMLHttpRequest}function U(e){e.isOpen?e.isReopen&&(e.isReopen=!1,b("re-opening",e.transport,e)):(e.isOpen=!0,b("opening",e.transport,e))}function q(e){var t=se;if((null!=e||"undefined"!=typeof e)&&(t=e),t.lastIndex=0,t.readyState=0,"jsonp"==t.transport||t.enableXDR&&n.util.checkCORSSupport())return void v(t);if(n.util.browser.msie&&n.util.browser.version<10){if("streaming"==t.transport)return void(t.enableXDR&&window.XDomainRequest?D(t):X(t));if(t.enableXDR&&window.XDomainRequest)return void D(t)}var o=function(){t.lastIndex=0,t.reconnect&&pe++<t.maxReconnectOnClose?(b("re-connecting",e.transport,e),E(r,t,e.reconnectInterval)):x(0,"maxReconnectOnClose reached")};if(t.force||t.reconnect&&(-1==t.maxRequest||t.requestCount++<t.maxRequest)){t.force=!1;var r=M();r.hasData=!1,A(r,t,!0),t.suspend&&(le=r),"polling"!=t.transport&&(ae.transport=t.transport,r.onabort=function(){te(!0)},r.onerror=function(){ae.error=!0;try{ae.status=XMLHttpRequest.status}catch(e){ae.status=500}ae.status||(ae.status=500),l(),ae.errorHandled||o()}),r.onreadystatechange=function(){if(!ge){ae.error=null;var s=!1,i=!1;if(n.util.browser.opera&&"streaming"==t.transport&&t.readyState>2&&4==r.readyState)return l(),void o();if(t.readyState=r.readyState,"streaming"==t.transport&&r.readyState>=3?i=!0:"long-polling"==t.transport&&4===r.readyState&&(i=!0),C(se),t.enableProtocol&&e.firstMessage||"polling"==t.transport||2!=r.readyState||U(t),i){var c=0;if(0!=r.readyState&&(c=r.status>1e3?0:r.status),c>=300||0==c)return ae.errorHandled=!0,l(),void o();var u=r.responseText;if(0==n.util.trim(u).length&&"long-polling"==t.transport)return void(r.hasData?r.hasData=!1:o());if(r.hasData=!0,Y(r,se),"streaming"==t.transport)if(n.util.browser.opera)n.util.iterate(function(){if(500!=ae.status&&r.responseText.length>t.lastIndex){try{ae.status=r.status,ae.headers=n.util.parseHeaders(r.getAllResponseHeaders()),Y(r,se)}catch(e){ae.status=404}C(se),ae.state="messageReceived";var o=r.responseText.substring(t.lastIndex);t.lastIndex=r.responseText.length,s=O(o,t,ae),s||ne(),a(r,t)}else if(ae.status>400)return t.lastIndex=r.responseText.length,!1},0);else{var d=u.substring(t.lastIndex,u.length);if(s=O(d,t,ae),t.lastIndex=u.length,s)return}else s=O(u,t,ae);try{ae.status=r.status,ae.headers=n.util.parseHeaders(r.getAllResponseHeaders()),Y(r,t)}catch(f){ae.status=404}t.suspend?ae.state=0==ae.status?"closed":"messageReceived":ae.state="messagePublished";var p="streaming"!=e.transport;p&&!t.executeCallbackBeforeReconnect&&E(r,t,0),0==ae.responseBody.length||s||ne(),p&&t.executeCallbackBeforeReconnect&&E(r,t,0),a(r,t)}}};try{r.send(t.data),fe=!0}catch(s){n.util.log(t.logLevel,["Unable to connect to "+t.url])}}else"debug"==t.logLevel&&n.util.log(t.logLevel,["Max re-connection reached."]),x(0,"maxRequest reached")}function A(e,t,o){var r=t.url;null!=t.dispatchUrl&&"POST"==t.method&&(r+=t.dispatchUrl),r=I(t,r),r=n.util.prepareURL(r),o&&(e.open(t.method,r,t.async),t.connectTimeout>-1&&(t.id=setTimeout(function(){0==t.requestCount&&(l(),K("Connect timeout","closed",200,t.transport))},t.connectTimeout))),se.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0),se.dropAtmosphereHeaders||(e.setRequestHeader("X-Atmosphere-Framework",n.util.version),e.setRequestHeader("X-Atmosphere-Transport",t.transport),void 0!=t.lastTimestamp?e.setRequestHeader("X-Cache-Date",t.lastTimestamp):e.setRequestHeader("X-Cache-Date",0),t.trackMessageLength&&e.setRequestHeader("X-Atmosphere-TrackMessageSize","true"),e.setRequestHeader("X-Atmosphere-tracking-id",t.uuid)),""!=t.contentType&&e.setRequestHeader("Content-Type",t.contentType),n.util.each(t.headers,function(r,s){var a=n.util.isFunction(s)?s.call(this,e,t,o,ae):s;null!=a&&e.setRequestHeader(r,a)})}function E(e,t,n){if(t.reconnect||t.suspend&&fe){var o=0;e&&0!=e.readyState&&(o=e.status>1e3?0:e.status),ae.status=0==o?204:o,ae.reason=0==o?"Server resumed the connection or down.":"OK",clearTimeout(t.id),t.id=setTimeout(function(){q(t)},n)}}function B(e){e.state="re-connecting",Z(e)}function D(e){"polling"!=e.transport?(ue=H(e),ue.open()):H(e).open()}function H(e){var t=se;null!=e&&"undefined"!=typeof e&&(t=e);var o=t.transport,r=0,s=new window.XDomainRequest,a=function(){"long-polling"==t.transport&&t.reconnect&&(-1==t.maxRequest||t.requestCount++<t.maxRequest)&&(s.status=200,D(t))},c=t.rewriteURL||function(e){var t=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(t&&t[1]){case"JSESSIONID":return e.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+t[2]+"$1");case"PHPSESSID":return e.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+t[2]+"&").replace(/&$/,"")}return e};s.onprogress=function(){u(s)},s.onerror=function(){"polling"!=t.transport&&(l(),pe++<t.maxReconnectOnClose?t.id=setTimeout(function(){b("re-connecting",e.transport,e),D(t)},t.reconnectInterval):x(0,"maxReconnectOnClose reached"))},s.onload=function(){};var u=function(e){clearTimeout(t.id);var s=e.responseText;if(s=s.substring(r),r+=s.length,"polling"!=o){t.id=setTimeout(function(){pe=t.maxReconnectOnClose,te(!0),i(),l()},t.timeout);var c=O(s,t,ae);if("long-polling"==o&&0==n.util.trim(s))return;t.executeCallbackBeforeReconnect&&a(),c||K(ae.responseBody,"messageReceived",200,o),t.executeCallbackBeforeReconnect||a()}};return{open:function(){var e=t.url;null!=t.dispatchUrl&&(e+=t.dispatchUrl),e=I(t,e),s.open(t.method,c(e)),"GET"==t.method?s.send():s.send(t.data),t.connectTimeout>-1&&(t.id=setTimeout(function(){0==t.requestCount&&(l(),K("Connect timeout","closed",200,t.transport))},t.connectTimeout))},close:function(){s.abort()}}}function X(e){ue=N(e),ue.open()}function N(e){var t=se;null!=e&&"undefined"!=typeof e&&(t=e);var o,r=new window.ActiveXObject("htmlfile");r.open(),r.close();var s=t.url;return null!=t.dispatchUrl&&(s+=t.dispatchUrl),"polling"!=t.transport&&(ae.transport=t.transport),{open:function(){var e=r.createElement("iframe");s=I(t),""!=t.data&&(s+="&X-Atmosphere-Post-Body="+encodeURIComponent(t.data)),s=n.util.prepareURL(s),e.src=s,r.body.appendChild(e);var a=e.contentDocument||e.contentWindow.document;o=n.util.iterate(function(){try{if(!a.firstChild)return;var e=a.body?a.body.lastChild:a,s=function(){var t=e.cloneNode(!0);t.appendChild(a.createTextNode("."));var n=t.innerText;return n=n.substring(0,n.length-1)};if(!a.body||!a.body.firstChild||"pre"!==a.body.firstChild.nodeName.toLowerCase()){var i=a.head||a.getElementsByTagName("head")[0]||a.documentElement||a,c=a.createElement("script");c.text="document.write('<plaintext>')",i.insertBefore(c,i.firstChild),i.removeChild(c),e=a.body.lastChild}return t.closed&&(t.isReopen=!0),o=n.util.iterate(function(){var n=s();if(n.length>t.lastIndex){C(se),ae.status=200,ae.error=null,e.innerText="";var o=O(n,t,ae);if(o)return"";K(ae.responseBody,"messageReceived",200,t.transport)}return t.lastIndex=0,"complete"===a.readyState?(te(!0),b("re-connecting",t.transport,t),t.id=setTimeout(function(){X(t)},t.reconnectInterval),!1):void 0},null),!1}catch(l){return ae.error=!0,b("re-connecting",t.transport,t),pe++<t.maxReconnectOnClose?t.id=setTimeout(function(){X(t)},t.reconnectInterval):x(0,"maxReconnectOnClose reached"),r.execCommand("Stop"),r.close(),!1}})},close:function(){o&&o(),r.execCommand("Stop"),te(!0)}}}function P(e){null!=he?J(e):null!=le||null!=ce?W(e):null!=ue?$(e):null!=de?z(e):null!=ie&&V(e)}function j(e,t){t||(t=Q(e)),t.transport="polling",t.method="GET",t.async=!1,t.reconnect=!1,t.force=!0,t.suspend=!1,q(t)}function J(e){he.send(e)}function F(e){if(0!=e.length)try{he?he.localSend(e):oe&&oe.signal("localMessage",n.util.stringifyJSON({id:be,event:e}))}catch(t){n.util.error(t)}}function W(e){var t=Q(e);q(t)}function $(e){if(se.enableXDR&&n.util.checkCORSSupport()){var t=Q(e);t.reconnect=!1,v(t)}else W(e)}function z(e){W(e)}function G(e){var t=e;return"object"==typeof t&&(t=e.data),t}function Q(e){var t=G(e),o={connected:!1,timeout:6e4,method:"POST",url:se.url,contentType:se.contentType,headers:se.headers,reconnect:!0,callback:null,data:t,suspend:!1,maxRequest:-1,logLevel:"info",requestCount:0,withCredentials:se.withCredentials,transport:"polling",isOpen:!0,attachHeadersAsQueryString:!0,enableXDR:se.enableXDR,uuid:se.uuid,dispatchUrl:se.dispatchUrl,enableProtocol:!1,messageDelimiter:"|",maxReconnectOnClose:se.maxReconnectOnClose};return"object"==typeof e&&(o=n.util.extend(o,e)),o}function V(e){var t,n=G(e);try{t=null!=se.dispatchUrl?se.webSocketPathDelimiter+se.dispatchUrl+se.webSocketPathDelimiter+n:n,ie.send(t)}catch(o){ie.onclose=function(e){},l(),L("Websocket failed. Downgrading to Comet and resending "+t),W(e)}}function _(e){var t=n.util.parseJSON(e);t.id!=be&&("undefined"!=typeof se.onLocalMessage?se.onLocalMessage(t.event):"undefined"!=typeof n.util.onLocalMessage&&n.util.onLocalMessage(t.event))}function K(e,t,n,o){ae.responseBody=e,ae.transport=o,ae.status=n,ae.state=t,ne()}function Y(e,t){if(!t.readResponsesHeaders&&!t.enableProtocol)return t.lastTimestamp=n.util.now(),void(t.uuid=be);try{var o=e.getResponseHeader("X-Cache-Date");o&&null!=o&&o.length>0&&(t.lastTimestamp=o.split(" ").pop());var r=e.getResponseHeader("X-Atmosphere-tracking-id");r&&null!=r&&(t.uuid=r.split(" ").pop()),t.headers&&n.util.each(se.headers,function(t){var n=e.getResponseHeader(t);n&&(ae.headers[t]=n)})}catch(s){}}function Z(e){ee(e,se),ee(e,n.util)}function ee(e,t){switch(e.state){case"messageReceived":pe=0,"undefined"!=typeof t.onMessage&&t.onMessage(e);break;case"error":"undefined"!=typeof t.onError&&t.onError(e);break;case"opening":"undefined"!=typeof t.onOpen&&t.onOpen(e);break;case"messagePublished":"undefined"!=typeof t.onMessagePublished&&t.onMessagePublished(e);break;case"re-connecting":"undefined"!=typeof t.onReconnect&&t.onReconnect(se,e);break;case"re-opening":"undefined"!=typeof t.onReopen&&t.onReopen(se,e);break;case"fail-to-reconnect":"undefined"!=typeof t.onFailureToReconnect&&t.onFailureToReconnect(se,e);break;case"unsubscribe":case"closed":var n="undefined"!=typeof se.closed?se.closed:!1;"undefined"==typeof t.onClose||n||t.onClose(e),se.closed=!0}}function te(e){"closed"!=ae.state&&(ae.state="closed",ae.responseBody="",ae.messages=[],ae.status=e?200:501,ne())}function ne(){var e=function(e,t){t(ae)};null==he&&null!=me&&me(ae.responseBody),se.reconnect=se.mrequest;for(var t="string"==typeof ae.responseBody,o=t&&se.trackMessageLength?ae.messages.length>0?ae.messages:[""]:new Array(ae.responseBody),s=0;s<o.length;s++)if(!(o.length>1&&0==o[s].length)&&(ae.responseBody=t?n.util.trim(o[s]):o[s],null==he&&null!=me&&me(ae.responseBody),0!=ae.responseBody.length||"messageReceived"!=ae.state)){if(Z(ae),r.length>0){"debug"==se.logLevel&&n.util.debug("Invoking "+r.length+" global callbacks: "+ae.state);try{n.util.each(r,e)}catch(a){n.util.log(se.logLevel,["Callback exception"+a])}}if("function"==typeof se.callback){"debug"==se.logLevel&&n.util.debug("Invoking request callbacks");try{se.callback(ae)}catch(a){n.util.log(se.logLevel,["Callback exception"+a])}}}}var oe,re,se={timeout:3e5,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:!0,maxRequest:-1,reconnect:!0,maxStreamingLength:1e7,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketBinaryType:null,dispatchUrl:null,webSocketPathDelimiter:"@@",enableXDR:!1,rewriteURL:!1,attachHeadersAsQueryString:!0,executeCallbackBeforeReconnect:!1,readyState:0,lastTimestamp:0,withCredentials:!1,trackMessageLength:!1,messageDelimiter:"|",connectTimeout:-1,reconnectInterval:0,dropAtmosphereHeaders:!0,uuid:0,async:!0,shared:!1,readResponsesHeaders:!1,maxReconnectOnClose:5,enableProtocol:!0,onError:function(e){},onClose:function(e){},onOpen:function(e){},onMessage:function(e){},onReopen:function(e,t){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){},onLocalMessage:function(e){},onFailureToReconnect:function(e,t){}},ae={status:200,reasonPhrase:"OK",responseBody:"",messages:[],headers:[],state:"messageReceived",transport:"polling",error:null,request:null,partialMessage:"",errorHandled:!1,id:0},ie=null,ce=null,le=null,ue=null,de=null,fe=!0,pe=0,ge=!1,me=null,he=null,be=n.util.now();d(e),this.subscribe=function(e){d(e),g()},this.execute=function(){g()},this.close=function(){c()},this.disconnect=function(){i()},this.getUrl=function(){return se.url},this.push=function(e,t){if(null!=t){var n=se.dispatchUrl;se.dispatchUrl=t,P(e),se.dispatchUrl=n}else P(e)},this.getUUID=function(){return se.uuid},this.pushLocal=function(e){F(e)},this.enableProtocol=function(e){return se.enableProtocol},this.request=se,this.response=ae}},n.subscribe=function(e,t,r){"function"==typeof t&&n.addCallback(t),"string"!=typeof e?r=e:r.url=e;var s=new n.AtmosphereRequest(r);return s.execute(),o[o.length]=s,s},n.unsubscribe=function(){if(o.length>0)for(var e=[].concat(o),t=0;t<e.length;t++){var n=e[t];n.close(),clearTimeout(n.response.request.id)}o=[],r=[]},n.unsubscribeUrl=function(e){var t=-1;if(o.length>0)for(var n=0;n<o.length;n++){var r=o[n];if(r.getUrl()==e){r.close(),clearTimeout(r.response.request.id),t=n;break}}t>=0&&o.splice(t,1)},n.addCallback=function(e){-1==n.util.inArray(e,r)&&r.push(e)},n.removeCallback=function(e){var t=n.util.inArray(e,r);-1!=t&&r.splice(t,1)},n.util={browser:{},parseHeaders:function(e){for(var t,n=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,o={};t=n.exec(e);)o[t[1]]=t[2];return o},now:function(){return(new Date).getTime()},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isBinary:function(e){var t=Object.prototype.toString.call(e);return"[object Blob]"===t||"[object ArrayBuffer]"===t},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},getAbsoluteURL:function(e){var t=document.createElement("div");return t.innerHTML='<a href="'+e+'"/>',encodeURI(decodeURI(t.firstChild.href))},prepareURL:function(e){var t=n.util.now(),o=e.replace(/([?&])_=[^&]*/,"$1_="+t);return o+(o===e?(/\?/.test(e)?"&":"?")+"_="+t:"")},trim:function(e){return String.prototype.trim?e.toString().trim():e.toString().replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},param:function(e){function t(e,t){t=n.util.isFunction(t)?t():null==t?"":t,s.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}function o(e,r){var s;if(n.util.isArray(r))n.util.each(r,function(n,r){/\[\]$/.test(e)?t(e,r):o(e+"["+("object"==typeof r?n:"")+"]",r)});else if("[object Object]"===Object.prototype.toString.call(r))for(s in r)o(e+"["+s+"]",r[s]);else t(e,r)}var r,s=[];for(r in e)o(r,e[r]);return s.join("&").replace(/%20/g,"+")},supportStorage:function(){var e=window.localStorage;if(e)try{return e.setItem("t","t"),e.removeItem("t"),window.StorageEvent&&!n.util.browser.msie&&!(n.util.browser.mozilla&&"1"===n.util.browser.version.split(".")[0])}catch(t){}return!1},iterate:function(e,t){var n;return t=t||0,function o(){n=setTimeout(function(){e()!==!1&&o()},t)}(),function(){clearTimeout(n)}},each:function(e,t,o){var r,s=0,a=e.length,i=n.util.isArray(e);if(o){if(i)for(;a>s&&(r=t.apply(e[s],o),r!==!1);s++);else for(s in e)if(r=t.apply(e[s],o),r===!1)break}else if(i)for(;a>s&&(r=t.call(e[s],s,e[s]),r!==!1);s++);else for(s in e)if(r=t.call(e[s],s,e[s]),r===!1)break;return e},extend:function(e){var t,n,o;for(t=1;t<arguments.length;t++)if(null!=(n=arguments[t]))for(o in n)e[o]=n[o];return e},on:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},off:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},log:function(e,t){if(window.console){var n=window.console[e];"function"==typeof n&&n.apply(window.console,t)}},warn:function(){n.util.log("warn",arguments)},info:function(){n.util.log("info",arguments)},debug:function(){n.util.log("debug",arguments)},error:function(){n.util.log("error",arguments)},xhr:function(){try{return new window.XMLHttpRequest}catch(e){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},parseJSON:function(e){return e?window.JSON&&window.JSON.parse?window.JSON.parse(e):new Function("return "+e)():null},stringifyJSON:function(e){function t(e){return'"'+e.replace(o,function(e){var t=r[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'}function n(e){return 10>e?"0"+e:e}var o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return window.JSON&&window.JSON.stringify?window.JSON.stringify(e):function s(e,o){var r,a,i,c,l=o[e],u=typeof l;switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e),u=typeof l),u){case"string":return t(l);case"number":return isFinite(l)?String(l):"null";case"boolean":return String(l);case"object":if(!l)return"null";switch(Object.prototype.toString.call(l)){case"[object Date]":return isFinite(l.valueOf())?'"'+l.getUTCFullYear()+"-"+n(l.getUTCMonth()+1)+"-"+n(l.getUTCDate())+"T"+n(l.getUTCHours())+":"+n(l.getUTCMinutes())+":"+n(l.getUTCSeconds())+'Z"':"null";case"[object Array]":for(i=l.length,c=[],r=0;i>r;r++)c.push(s(r,l)||"null");return"["+c.join(",")+"]";
default:c=[];for(r in l)hasOwn.call(l,r)&&(a=s(r,l),a&&c.push(t(r)+":"+a));return"{"+c.join(",")+"}"}}}("",{"":e})},checkCORSSupport:function(){if(n.util.browser.msie&&!window.XDomainRequest)return!0;if(n.util.browser.opera&&n.util.browser.version<12)return!0;var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android")>-1;return t?!0:!1}},e=n.util.now(),function(){var e=navigator.userAgent.toLowerCase(),t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];n.util.browser[t[1]||""]=!0,n.util.browser.version=t[2]||"0",(n.util.browser.msie||n.util.browser.mozilla&&"1"===n.util.browser.version.split(".")[0])&&(n.util.storage=!1)}(),n.util.on(window,"unload",function(e){n.unsubscribe()}),n.util.on(window,"keypress",function(e){27===e.which&&e.preventDefault()}),n.util.on(window,"offline",function(){n.unsubscribe()}),window.atmosphere=n}();