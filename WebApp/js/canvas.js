function GameObject(){this.zOrder=0,this.x=0,this.y=0,this.startupGameObject=function(t,e,i){return this.zOrder=i,this.x=t,this.y=e,g_GameObjectManager.addGameObject(this),this},this.shutdownGameObject=function(){g_GameObjectManager.removeGameObject(this)}}function VisualGameObject(){this.image=null,this.draw=function(t,e,i,a){e.drawImage(this.image,this.x-i,this.y-a)},this.startupVisualGameObject=function(t,e,i,a){return this.startupGameObject(e,i,a),this.image=t,this},this.shutdownVisualGameObject=function(){this.shutdownGameObject()}}function RepeatingGameObject(){this.width=0,this.height=0,this.scrollFactor=1,this.startupRepeatingGameObject=function(t,e,i,a,s,h,n){return this.startupVisualGameObject(t,e,i,a),this.width=s,this.height=h,this.scrollFactor=n,this},this.shutdownstartupRepeatingGameObject=function(){this.shutdownVisualGameObject()},this.draw=function(t,e,i,a){for(var s=[0,0],h=0;h<this.height;h+=s[1])for(var n=0;n<this.width;n+=s[0]){var r=[this.x+n,this.y+h],c=[this.width-n,this.height-h],m=[0,0];0==n&&(m[0]=i*this.scrollFactor),0==h&&(m[1]=a*this.scrollFactor),s=this.drawRepeat(e,r,c,m)}},this.drawRepeat=function(t,e,i,a){var s=Math.abs(a[0])%this.image.width,h=Math.abs(a[1])%this.image.height,n=a[0]<0?this.image.width-s:s,r=a[1]<0?this.image.height-h:h,c=i[0]<this.image.width-n?i[0]:this.image.width-n,m=i[1]<this.image.height-r?i[1]:this.image.height-r;return t.drawImage(this.image,n,r,c,m,e[0],e[1],c,m),[c,m]}}function AnimatedGameObject(){this.currentFrame=0,this.timeBetweenFrames=0,this.timeSinceLastFrame=0,this.frameWidth=0,this.startupAnimatedGameObject=function(t,e,i,a,s,h){if(0>=s)throw"framecount can not be <= 0";if(0>=h)throw"fps can not be <= 0";this.startupVisualGameObject(t,e,i,a),this.currentFrame=0,this.frameCount=s,this.timeBetweenFrames=1/h,this.timeSinceLastFrame=this.timeBetweenFrames,this.frameWidth=this.image.width/this.frameCount},this.draw=function(t,e,i,a){var s=this.frameWidth*this.currentFrame;e.drawImage(this.image,s,0,this.frameWidth,this.image.height,this.x-i,this.y-a,this.frameWidth,this.image.height),this.timeSinceLastFrame-=t,this.timeSinceLastFrame<=0&&(this.timeSinceLastFrame=this.timeBetweenFrames,++this.currentFrame,this.currentFrame%=this.frameCount)}}function ApplicationManager(){this.startupApplicationManager=function(){return this.runner=(new AnimatedGameObject).startupAnimatedGameObject(g_run,0,0,1,cTotalFrames,FPS),this}}function GameObjectManager(){this.gameObjects=new Array,this.lastFrame=(new Date).getTime(),this.xScroll=0,this.yScroll=0,this.applicationManager=null,this.canvas=null,this.context2D=null,this.backBuffer=null,this.backBufferContext2D=null,this.startupGameObjectManager=function(){return g_GameObjectManager=this,this.canvas=document.getElementById("canvas"),this.context2D=this.canvas.getContext("2d"),this.backBuffer=document.createElement("canvas"),this.backBuffer.width=this.canvas.width,this.backBuffer.height=this.canvas.height,this.backBufferContext2D=this.backBuffer.getContext("2d"),this.applicationManager=(new ApplicationManager).startupApplicationManager(),setInterval(function(){g_GameObjectManager.draw()},SECONDS_BETWEEN_FRAMES),this},this.draw=function(){var t=(new Date).getTime(),e=(t-this.lastFrame)/1e3;this.lastFrame=t,this.backBufferContext2D.clearRect(0,0,this.backBuffer.width,this.backBuffer.height),this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height);for(x in this.gameObjects)this.gameObjects[x].update&&this.gameObjects[x].update(e,this.backBufferContext2D,this.xScroll,this.yScroll);for(x in this.gameObjects)this.gameObjects[x].draw&&this.gameObjects[x].draw(e,this.backBufferContext2D,this.xScroll,this.yScroll);this.context2D.drawImage(this.backBuffer,0,0)},this.addGameObject=function(t){this.gameObjects.push(t),this.gameObjects.sort(function(t,e){return t.zOrder-e.zOrder})},this.removeGameObject=function(t){this.gameObjects.removeObject(t)}}function initCanvas(){(new GameObjectManager).startupGameObjectManager()}VisualGameObject.prototype=new GameObject,RepeatingGameObject.prototype=new VisualGameObject,AnimatedGameObject.prototype=new VisualGameObject,Array.prototype.remove=function(t,e){var i=this.slice((e||t)+1||this.length);return this.length=0>t?this.length+t:t,this.push.apply(this,i)},Array.prototype.removeObject=function(t){for(var e=0;e<this.length;++e)if(this[e]===t){this.remove(e);break}};