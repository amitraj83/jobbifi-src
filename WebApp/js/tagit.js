!function(t){t.fn.autoGrowInput=function(e){return e=t.extend({maxWidth:1e3,minWidth:0,comfortZone:70},e),this.filter("input:text").each(function(){var i=e.minWidth||t(this).width(),s="",a=t(this),n=t("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:a.css("fontSize"),fontFamily:a.css("fontFamily"),fontWeight:a.css("fontWeight"),letterSpacing:a.css("letterSpacing"),whiteSpace:"nowrap"}),o=function(){if(s!==(s=a.val())){var t=s.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");n.html(t);var o=n.width(),l=o+e.comfortZone>=i?o+e.comfortZone:i,r=a.width(),h=r>l&&l>=i||l>i&&l<e.maxWidth;if(h){var p=a.attr("style");a.css("cssText","width: "+l+"px !important;"+p)}}};n.insertAfter(a),t(this).bind("keyup keydown blur update",o)}),this}}(jQuery),function(t){t.widget("custom.catcomplete",t.ui.autocomplete,{_renderMenu:function(e,i){var s=this,a="";t.each(i,function(t,i){i.category&&i.category!=a&&(e.append("<li class='ui-autocomplete-category'>"+i.category+"</li>"),a=i.category),s._renderItemData(e,i)})}}),t.widget("ui.tagit",{options:{tagSource:[],triggerKeys:["enter","space","comma","tab","semicolon"],seperatorKeys:["comma","semicolon"],initialTags:[],defaultType:"none",minLength:1,autocompleteMinLength:1,select:!1,allowNewTags:!0,caseSensitive:!1,sortable:!1,editable:!1,highlightOnExistColor:"#0F0",emptySearch:!0,tagsChanged:function(t,e,i){},maxTags:void 0,blurOnPaste:!0},_splitAt:/\ |,/g,_existingAtIndex:0,_keys:{backspace:[8],enter:[13],space:[32],comma:[44,188],tab:[9],semicolon:[59,186]},_sortable:{sorting:-1},_idEditing:!1,_create:function(){var e=this;this.tagsArray=[],this.timer=null,this.lastKey=0,this.element.addClass("tagit"),this.element.children("li").each(function(){var i=t(this),s=i.attr("tagValue")||i.data("value");e.options.initialTags.push({label:i.text(),value:s?s:i.text()})}),pushRegex=function(s,a,n){-1!=t.inArray(a,e.options.seperatorKeys)&&i.push(n)},e._splitAt=null;var i=[];pushRegex(i,"space",/\ /),pushRegex(i,"semicolon",/;/),pushRegex(i,"comma",/,/);var s=t.map(i,function(t){return t.source}).join("|");e._splitAt=new RegExp(s,"g"),this.element.html('<li class="tagit-new"><input class="tagit-input" type="text" /></li>'),this.input=this.element.find(".tagit-input"),this.input.autoGrowInput(),t(this.element).click(function(i){if(t(i.target).hasClass("tagit-close")){var s=t(i.target).parent(),a=e.tagsArray[s.index()];a.element.remove(),e._popTag(a)}else e._isEditing||e.input.focus(),e.options.emptySearch&&t(i.target).hasClass("tagit-input")&&""==e.input.val()&&void 0!=e.input.catcomplete&&e.input.catcomplete("search"),e.options.editable&&t(i.target).hasClass("tagit-label")&&e._edit(i.target)});var a=this.options.select,n=this.options.minLength;if(this.options.appendTo=this.element,this.options.source=this.options.tagSource,this.options.select=function(t,i){return e.input.data("autoCompleteTag",!0),clearTimeout(e.timer),void 0!==e.options.maxTags&&e.tagsArray.length==e.options.maxTags?e.input.val(""):void 0===i.item.label?e._addTag({label:i.item.value}):e._addTag({label:i.item.label,value:i.item.value,type:i.item.category}),!1},this.options.focus=function(t,i){return void 0!==i.item.label&&/^key/.test(t.originalEvent.type)?(e.input.val(i.item.label),e.input.data("value",i.item.value),!1):void 0},this.options.autoFocus=!this.options.allowNewTags,this.options.minLength=this.options.autocompleteMinLength,this.input.catcomplete(this.options),this.options.minLength=n,this.options.select=a,e.isKeyEventProcessed=!1,this.input.keyup(function(t){e.isKeyEventProcessed=!1}),this.input.keydown(function(t){e._processKeyEvent(t)}),this.input.keypress(function(t){e._processKeyEvent(t)}),this.input.bind("paste",function(i){if(e.options.blurOnPaste){var s=t(this);e.timer=setTimeout(function(){s.blur()},0)}}),this.input.blur(function(i){return e.currentLabel=t(this).val(),e.currentValue=t(this).data("value"),e.options.allowNewTags&&(e.timer=setTimeout(function(){e._addTag({label:e.currentLabel,value:e.currentValue,type:e.options.defaultType}),e.currentValue="",e.currentLabel=""},400)),t(this).val("").removeData("value"),!1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),this.options.select&&(this.select=t('<select class="tagit-hiddenSelect" name="'+(this.element.attr("name")||this.element.data("name"))+'" multiple="multiple"></select>'),this.element.after(this.select)),this._initialTags(),e.options.sortable!==!1){var o={items:".tagit-choice",containment:"parent",opacity:.6,tolerance:"pointer",start:function(i,s){e._sortable.tag=t(s.item),e._sortable.origIndex=e._sortable.tag.index()},update:function(t,i){if(e._sortable.newIndex=e._sortable.tag.index(),e._moveTag(e._sortable.origIndex,e._sortable.newIndex),e.options.tagsChanged){var s=e.tagsArray[e._sortable.newIndex];e.options.tagsChanged(s.value,"moved",s.element)}}};"handle"==e.options.sortable&&(o.handle="a.ui-icon",o.cursor="move"),e.element.sortable(o)}},_processKeyEvent:function(t){if(!this.isKeyEventProcessed){var e=t.which||t.keyCode||t.charCode,i=this.element.children(".tagit-choice:last");if(this.isKeyEventProcessed=!0,e==this._keys.backspace)return this._backspace(i);!this._isInitKey(e)||this._isTabKey(e)&&""==this.value&&!this.input.data("autoCompleteTag")||(t.preventDefault(),this.input.data("autoCompleteTag",!1),!this.options.allowNewTags||void 0!==this.options.maxTags&&this.tagsArray.length==this.options.maxTags?this.input.val(""):this.options.allowNewTags&&this.input.val().length>=this.options.minLength&&this._addTag({label:this.input.val(),type:this.options.defaultType})),void 0!==this.options.maxLength&&this.input.val().length>this.options.maxLength&&(t.preventDefault(),this.input.val(this.input.val().substring(0,this.options.maxLength))),i.hasClass("selected")&&i.removeClass("selected"),this.lastKey=e}},_postEdit:function(e,i,s){var a=t.proxy(function(){i.remove(),t(e).removeClass("hidden"),t(e).parent().removeClass("edited"),this._isEditing=!1},this);return function(){var n=t(e).parent().index(),o=this.tagsArray[n],l=i.val();if(this._splitAt&&l.search(this._splitAt)>0&&(l=l.split(this._splitAt)[0]),l==s)a();else if(this._addTag({label:l})){o.element.remove(),this._popTag(o);var r=this.tagsArray.length-1;if(r!=n){var h=this.tagsArray[r];if(h.element.insertBefore(this.tagsArray[n].element),this._moveTag(this.tagsArray.length-1,n),this.options.tagsChanged){var p=this.tagsArray[n];this.options.tagsChanged(p.value,"moved",p.element)}}a()}}},_edit:function(e){this._isEditing=!0;var i=t(e).text(),s=t("<input>");s.val(i),t(e).parent().addClass("edited"),s.addClass("tagit-edit"),s.css("width",t(e).outerWidth()),t(e).addClass("hidden"),s.blur(t.proxy(this._postEdit(e,s,i),this)),s.keypress(t.proxy(function(t){var e=t.which||t.keyCode||t.charCode;this._isInitKey(e)&&s.blur()},this)),t(e).before(s),s[0].select()},_popSelect:function(e){t("option:eq("+e.index+")",this.select).remove(),this.select.change()},_addSelect:function(t){this.select.append('<option selected="selected" value="'+t.value+'">'+t.label+"</option>"),this.select.change()},_popTag:function(t){void 0===t?t=this.tagsArray.pop():this.tagsArray.splice(t.index,1);for(var e in this.tagsArray)this.tagsArray[e].index=e;this.options.select&&this._popSelect(t),this.options.tagsChanged&&this.options.tagsChanged(t?t.value||t.label:null,"popped",t)},_addTag:function(e){if(void 0===e.label&&(e.label=e.value),this.input.catcomplete("close").val(""),!(this._splitAt&&e.label.search(this._splitAt)>0)){if(e.label=e.label.replace(/,+$/,"").trim(),""==e.label)return!1;e.label=e.label.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var i=this._exists(e.label,e.value);if(i!==!1)return this._highlightExisting(i),!1;var s=this.tag(e.label,e.value,e.type);return s.element=t('<li class="tagit-choice'+(void 0!==e.type?" tagit-type-"+e.type+'"':'"')+(void 0!==e.value?' tagValue="'+e.value+'"':"")+">"+("handle"==this.options.sortable?'<a class="ui-icon ui-icon-grip-dotted-vertical" style="float:left"></a>':"")+'<div class="tagit-label">'+e.label+'</div><a class="tagit-close">x</a></li>'),s.element.insertBefore(this.input.parent()),this.tagsArray.push(s),this.input.val(""),this.options.select&&this._addSelect(s),this.options.tagsChanged&&this.options.tagsChanged(s.label,"added",s.element),!0}for(var a=e.label.split(this._splitAt),n=0;n<a.length;n++)this._addTag({label:a[n],value:e.value})},_exists:function(t,e){if(0==this.tagsArray.length)return!1;t=this._lowerIfCaseInsensitive(t),e=this._lowerIfCaseInsensitive(e);for(var i in this.tagsArray)if(this._lowerIfCaseInsensitive(this.tagsArray[i].label)==t){if(void 0===e)return i;if(this._lowerIfCaseInsensitive(this.tagsArray[i].value)==e)return i}return!1},_highlightExisting:function(t){if(void 0!==this.options.highlightOnExistColor){var e=this.tagsArray[t];e.element.stop();var i=e.element.css("color");e.element.animate({color:this.options.highlightOnExistColor},100).animate({color:i},800,null,function(){e.element.attr("style","")})}},_isInitKey:function(e){var i="";for(var s in this._keys)-1!=t.inArray(e,this._keys[s])&&(i=s);return-1!=t.inArray(i,this.options.triggerKeys)?!0:!1},_isTabKey:function(e){var i=this._keys.tab;return t.inArray(e,i)>-1},_removeTag:function(){this._popTag(),this.element.children(".tagit-choice:last").remove()},_backspace:function(t){return""==this.input.val()&&(this.lastKey==this._keys.backspace?(this._popTag(),t.remove(),this.lastKey=null):(t.addClass("selected"),this.lastKey=this._keys.backspace)),!0},_initialTags:function(){var e,i=this;this.options.tagsChanged&&(e=this.options.tagsChanged),this.options.tagsChanged=null,0!=this.options.initialTags.length&&t(this.options.initialTags).each(function(t,e){"object"==typeof e?i._addTag({label:e.label,value:e.value,type:e.type}):i._addTag({label:e})}),this.options.tagsChanged=e,this.options.tagsChanged(null,"tagsInited",null)},_lowerIfCaseInsensitive:function(t){return void 0===t||"string"!=typeof t?t:this.options.caseSensitive?t:t.toLowerCase()},_moveTag:function(e,i){this.tagsArray.splice(i,0,this.tagsArray.splice(e,1)[0]);for(var s in this.tagsArray)this.tagsArray[s].index=s;this.options.select&&t("option:eq("+e+")",this.select).insertBefore(t("option:eq("+i+")",this.select))},tags:function(){return this.tagsArray},destroy:function(){t.Widget.prototype.destroy.apply(this,arguments),clearTimeout(this.timer),this.tagsArray=[]},reset:function(){this.element.find(".tagit-choice").remove(),this.tagsArray=[],this.options.select&&(this.select.children().remove(),this.select.change()),this._initialTags(),this.options.tagsChanged&&this.options.tagsChanged(null,"reset",null)},fill:function(t){void 0!==t&&(this.options.initialTags=t),this.reset()},add:function(t,e){return"object"==typeof t?this._addTag({label:t.label,value:t.value}):this._addTag({label:t,value:e})},autocomplete:function(){return this.input.data("autocomplete")},tag:function(t,e,i,s){var a=this;return{label:t,value:void 0===e?t:e,type:i,element:s,index:a.tagsArray.length}},remove:function(t,e){if(0==this.tagsArray.length)return!1;t=this._lowerIfCaseInsensitive(t),e=this._lowerIfCaseInsensitive(e);for(var i=0;i<this.tagsArray.length&&(this._lowerIfCaseInsensitive(this.tagsArray[i].value)!=e&&this._lowerIfCaseInsensitive(this.tagsArray[i].label)!=t);i++);if(i>=0&&i<this.tagsArray.length){var s=this.tagsArray[i];return s.element.remove(),this._popTag(s),!0}return!1}})}(jQuery);